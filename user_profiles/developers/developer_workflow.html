<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick-Start: Developer Workflow &mdash; Spack-Manager 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Snapshot Developer Workflow Example" href="snapshot_workflow.html" />
    <link rel="prev" title="Developers: What you need to know about Spack" href="developer_spack_minimum.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Spack-Manager
          </a>
              <div class="version">
                0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../user_profiles.html">User Profiles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../analysts/analysts.html">Analysts Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="developers.html">Developer Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="developer_spack_minimum.html">Developers: What you need to know about Spack</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Quick-Start: Developer Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="snapshot_workflow.html">Snapshot Developer Workflow Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="useful_commands.html">Useful Commands for Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="external.html">Externals and snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../system_admins/system_admins.html">System Administrator Documentation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general/FAQ.html">Frequently Asked Questions:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/general.html">General Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Spack-Manager</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../user_profiles.html">User Profiles</a> &raquo;</li>
          <li><a href="developers.html">Developer Documentation</a> &raquo;</li>
      <li>Quick-Start: Developer Workflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/user_profiles/developers/developer_workflow.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quick-start-developer-workflow">
<h1>Quick-Start: Developer Workflow<a class="headerlink" href="#quick-start-developer-workflow" title="Permalink to this headline"></a></h1>
<p>In this section we will go over the developer work flow in Spack-Manager using the <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/useful_commands.html">quick-functions</a>.</p>
<p>This tutorial assumes you are familiar with the <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/developer_spack_minimum.html">3 things developers need to know</a>.
If you are unfamiliar with these 3 things then please review the documentation before proceeding.</p>
<p>The developer workflow will be covered in 4 stages:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#setup-spack-manager"><span class="std std-doc">Setting up Spack-Manager</span></a></p></li>
<li><p><a class="reference internal" href="#creating-an-environment"><span class="std std-doc">Create an environment for development</span></a></p></li>
<li><p><a class="reference internal" href="#building-and-making-code-changes"><span class="std std-doc">Building and making code changes</span></a></p></li>
<li><p><a class="reference internal" href="#running-tests-and-coming-back"><span class="std std-doc">Running tests and coming back</span></a></p></li>
</ol>
<p>There is also the <a class="reference internal" href="#quick-start"><span class="std std-doc">quick start</span></a> below that just lists all the commands for you in a row.</p>
<section id="setup-spack-manager">
<h2>Setup Spack-Manager<a class="headerlink" href="#setup-spack-manager" title="Permalink to this headline"></a></h2>
<p>Setting up Spack-Manager should be a 1 time thing on a given machine.
First pick directory you want to store Spack-Manager.
The ideal location for this directory is one that has adequate storage for multiple build environments,
and it should also be on a filesytem that is accesible where you plan to run the software.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone --recursive git@github.com:psakievich/spack-manager.git</span>
</pre></div>
</div>
<p>In order for Spack-Manager to work you need to define the <code class="docutils literal notranslate"><span class="pre">SPACK_MANAGER</span></code> environment variable,
and it should provide the absolute path to your Spack-Manager directory. To have access to the
commands we will use in this tutorial you need to source <code class="docutils literal notranslate"><span class="pre">$SPACK_MANAGER/start.sh</span></code>.
This script enables all the shell functions in Spack-Manager but it does not activate Spack.
We do this to allow you to add these lines to your <code class="docutils literal notranslate"><span class="pre">bash_profile</span></code> without any penalty
since sourcing Spack adds an unacceptable level of overhead for standard shell spawning,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>These lines can be added to your bash_profile
<span class="go">export SPACK_MANAGER=$(pwd)/spack-manager</span>
<span class="go">source $SPACK_MANAGER/start.sh</span>
</pre></div>
</div>
</section>
<section id="creating-an-environment">
<h2>Creating an Environment<a class="headerlink" href="#creating-an-environment" title="Permalink to this headline"></a></h2>
<p>With the Spack development workflow we are going to create an environment similar to a Conda environment.
Setting up the environments is a multistep process that is outlined in greater detail <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/snapshot_workflow.html">here</a> and <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/useful_commands.html#environment-setup-process">here</a>.
There are three <code class="docutils literal notranslate"><span class="pre">quick-commands</span></code> for creating environments: <code class="docutils literal notranslate"><span class="pre">quick-create</span></code>, <code class="docutils literal notranslate"><span class="pre">quick-create-dev</span></code> and <code class="docutils literal notranslate"><span class="pre">quick-develop</span></code>.
They all exit the process of setting up an environment at different points in the process as outlined below:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="text-left head"><p>Step</p></th>
<th class="text-center head"><p>quick-create</p></th>
<th class="text-center head"><p>quick-create-dev</p></th>
<th class="text-center head"><p>quick-develop</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>spack-start</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Create an environment</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Activate an environment</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Add root specs</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Add develop specs</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>x</p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Add externals</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>x</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Concretize and install</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
<p>For developers we recommend using <code class="docutils literal notranslate"><span class="pre">quick-create-dev</span></code> and <code class="docutils literal notranslate"><span class="pre">quick-develop</span></code> depending on if you want to use externals or not.</p>
<p>The interface for both of these commands is exactly the same.  Moving forward we will use <code class="docutils literal notranslate"><span class="pre">quick-create-dev</span></code> in this example.
To see the options for the command we can run it with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> command.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">quick-create-dev -h</span>
<span class="go">+ spack-start</span>
<span class="go">*************************************************************</span>
<span class="go">HELP MESSAGE:</span>
<span class="go">quick-create-dev sets up a developer environment</span>
<span class="go">where all specs are develop specs that will be automatically cloned</span>
<span class="go">from the default repos</span>
<span class="go">    </span>
<span class="go">The next typical steps after running this command are to add externals if</span>
<span class="go">you want them, or run spack install.</span>
<span class="go">    </span>
<span class="go">The base command and it&#39;s help are echoed below:</span>
<span class="go">    </span>

<span class="go">+ spack manager create-dev-env -h</span>
<span class="go">usage: spack manager create-dev-env [-h] [-m MACHINE] [-d DIRECTORY | -n NAME] [-y YAML] [-s SPEC [SPEC ...]]</span>

<span class="go">optional arguments:</span>
<span class="go">  -d DIRECTORY, --directory DIRECTORY</span>
<span class="go">                        Directory to copy files</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -m MACHINE, --machine MACHINE</span>
<span class="go">                        Machine to match configs</span>
<span class="go">  -n NAME, --name NAME  Name of directory to copy files that will be in $SPACK_MANAGER/environments</span>
<span class="go">  -s SPEC [SPEC ...], --spec SPEC [SPEC ...]</span>
<span class="go">                        Specs to populate the environment with</span>
<span class="go">  -y YAML, --yaml YAML  Reference spack.yaml to copy to directory</span>
<span class="go">*************************************************************</span>
</pre></div>
</div>
<p>The main flags to use for standard developer workflow are the <code class="docutils literal notranslate"><span class="pre">--name</span></code> or <code class="docutils literal notranslate"><span class="pre">--directory</span></code> flags and the <code class="docutils literal notranslate"><span class="pre">--spec</span></code> flags.</p>
<p>To set up a build of the exawind driver where we are developing <code class="docutils literal notranslate"><span class="pre">amr-wind</span></code> and <code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code> too we would run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">quick-create-dev -n example-env -s exawind@master nalu-wind@master amr-wind@main</span>
</pre></div>
</div>
<p>If you don’t want to develop one of these packages (say you’re only focused on <code class="docutils literal notranslate"><span class="pre">amr-wind</span></code>) then just ommit the software you don’t
plan to develop in from the spec list in the command above. Please note that these specs need to be concrete specs, meaning they have the name
(<code class="docutils literal notranslate"><span class="pre">amr-wind</span></code>) and the version from spack (<code class="docutils literal notranslate"><span class="pre">main</span></code>), and that <strong>that the version is not necessarily the same thing as the branch</strong>.
This is covered in the <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/developer_spack_minimum.html">things developers need to know about Spack</a> for those needing a refresher.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-n</span></code> flag can be replaced with <code class="docutils literal notranslate"><span class="pre">-d</span></code> if we want to setup an environment in a different location than <code class="docutils literal notranslate"><span class="pre">$SPACK_MANAGER/environments</span></code> (see the help message above).
The <code class="docutils literal notranslate"><span class="pre">quick-create-dev</span></code> command will execute all the stages in the table above including cloning the repos from github for the software.
These clones of the source code default to the environment directory you specified with the <code class="docutils literal notranslate"><span class="pre">-d</span></code> or <code class="docutils literal notranslate"><span class="pre">-n</span></code> flags.
If we wish to work off specific branches then we can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">remote</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span></code> to get the branches we want
inside each of the clones before building.</p>
<p>If you wish to pre-clone your repos you can simply create a directory, pre-clone the software you want to develop with names that match the package names and run your <code class="docutils literal notranslate"><span class="pre">quick-create-dev</span></code> inside the directory you created without either of the <code class="docutils literal notranslate"><span class="pre">-d</span></code> or <code class="docutils literal notranslate"><span class="pre">-n</span></code> flags.
This is because the default behavior of the command is to create the environment files, and clone repos in the current
working directory.</p>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir test &amp;&amp; cd test</span>
<span class="gp"># </span>note that we name the clone of exawind-driver <span class="s1">&#39;exawind&#39;</span> <span class="k">in</span> the clone process to match the spack package name
<span class="go">git clone --recursive --branch main git@github.com:Exawind/exawind-driver.git exawind</span>
<span class="go">git clone --recursive --branch master git@github.com:Exawind/nalu-wind.git</span>
<span class="go">git clone --recursive --branch main git@github.com:Exawind/amr-wind.git</span>
<span class="go">quick-create-dev -s exawind@main amr-wind@main nalu-wind@master</span>
<span class="go">+ spack-start</span>
<span class="go">+ spack manager create-dev-env -s exawind@master amr-wind@main nalu-wind@master</span>
<span class="go">==&gt; Configuring spec exawind@master for development at path exawind</span>
<span class="go">==&gt; Warning: included configuration files should be updated manually [files=include.yaml]</span>
<span class="go">==&gt; Configuring spec amr-wind@main for development at path amr-wind</span>
<span class="go">==&gt; Configuring spec nalu-wind@master for development at path nalu-wind</span>
<span class="go">+ spack env activate --dir /current/working/directory --prompt</span>
</pre></div>
</div>
<p>does the same thing as</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">quick-create-dev -d test -s exawind@master nalu-wind@master amr-wind@main</span>
</pre></div>
</div>
<p>However, adding in the extra pre-clone steps gives you a little more control over your environment.</p>
<p>At this point in the process your environment is active and all setup.
You can confirm that it is active with <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">env</span> <span class="pre">status</span></code> which displays the active environment.</p>
</section>
<section id="building-and-making-code-changes">
<h2>Building and Making Code Changes<a class="headerlink" href="#building-and-making-code-changes" title="Permalink to this headline"></a></h2>
<p>Once the environment is setup and active you can simply run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">spack install</span>
</pre></div>
</div>
<p>to build the software.</p>
<p>In this case we are building without externals so you will see <code class="docutils literal notranslate"><span class="pre">clingo</span></code> get bootstrapped, concretization happen, and then the install occur for the entire software stack.</p>
<p>You are free to make code changes in any of the code directories.
Re-running <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span></code> will cause Spack to check for changes by inspecting the time-date stamp on the files in the source code directories.
If they are newer than the install time then it will trigger an incremental build to capture any changes that might exist.
Any changes you make in a dependency will also trigger a rebuild of the upstream software too.
In this environment if you make a change in <code class="docutils literal notranslate"><span class="pre">amr-wind</span></code> it will also trigger a rebuild of the <code class="docutils literal notranslate"><span class="pre">exawind</span></code> package as well.</p>
</section>
<section id="running-tests-and-coming-back">
<h2>Running Tests and Coming Back<a class="headerlink" href="#running-tests-and-coming-back" title="Permalink to this headline"></a></h2>
<p>To run tests in a one off manner you can use the <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">build-env</span></code> command to run commands in a sub-shell with the build environment.
This is further documented <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/snapshot_workflow.html#running">here</a>.
We also have a function <code class="docutils literal notranslate"><span class="pre">build-env-dive</span></code> which is a beta feature that launches this same subshell in your terminal and dives into it.
It is further documented <a class="reference external" href="https://psakievich.github.io/spack-manager/user_profiles/developers/useful_commands.html#build-env-dive">here</a>.</p>
<p>If you wish to come back to an environment later, or in a new shell you can just run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">quick-activate /path/to/the/environment/you/wish/to/activate</span>
</pre></div>
</div>
<p>and this will do all the activation for the environment for you.
You will be able to come back at anytime and pick up where you left off.</p>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline"></a></h2>
<p>These are the commands needed to set up Spack-Manager and a development build for the exawind-driver with the intention of editing <code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code> and <code class="docutils literal notranslate"><span class="pre">amr-wind</span></code> at the same time.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>setup Spack-Manager
<span class="go">git clone --recursive git@github.com:psakievich/spack-manager.git</span>
<span class="go">export SPACK_MANAGER=$(pwd)/spack-manager</span>
<span class="go">source $SPACK_MANAGER/start.sh</span>
<span class="gp"># </span>setup environment
<span class="go">quick-create-dev -n demo -s exawind@master amr-wind@main nalu-wind@master</span>
<span class="gp"># </span>build code
<span class="go">spack install</span>
<span class="gp"># </span>code changes
<span class="gp"># </span>....
<span class="gp"># </span>re-build
<span class="go">spack install</span>
<span class="gp"># </span>run all the overset regression tests <span class="k">in</span> nalu-wind
<span class="go">spack build-env nalu-wind ctest -R overset</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developer_spack_minimum.html" class="btn btn-neutral float-left" title="Developers: What you need to know about Spack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="snapshot_workflow.html" class="btn btn-neutral float-right" title="Snapshot Developer Workflow Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>